version: '3'
networks:
  mall-network:
    name: mall-network
    external: true
services:
  mall-admin:
    image: registry.cn-hangzhou.aliyuncs.com/yinshi/guanghengzou-mall-admin:1.0-SNAPSHOT
    container_name: mall-admin
    restart: unless-stopped
    ports:
      - 8080:8080
    volumes:
      - /mydata/app/mall-admin/logs:/var/logs
      - /etc/localtime:/etc/localtime
    environment:
      - TZ=Asia/Shanghai
      - JAVA_OPTS=-Xms256m -Xmx384m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Djava.security.egd=file:/dev/./urandom
      - spring.profiles.active=prod
    deploy:
      resources:
        limits:
          cpus: '0.4'
          memory: 512M
        reservations:
          cpus: '0.2'
          memory: 256M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 60s
      timeout: 15s
      retries: 5
      start_period: 180s
    networks:
      - mall-network
  mall-portal:
    image: registry.cn-hangzhou.aliyuncs.com/yinshi/guanghengzou-mall-portal:1.0-SNAPSHOT
    container_name: mall-portal
    restart: unless-stopped
    ports:
      - 8085:8085
    volumes:
      - /mydata/app/mall-portal/logs:/var/logs
      - /etc/localtime:/etc/localtime
    environment:
      - TZ=Asia/Shanghai
      - JAVA_OPTS=-Xms256m -Xmx384m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Djava.security.egd=file:/dev/./urandom
      - spring.profiles.active=prod
    deploy:
      resources:
        limits:
          cpus: '0.4'
          memory: 512M
        reservations:
          cpus: '0.2'
          memory: 256M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8085/actuator/health"]
      interval: 60s
      timeout: 15s
      retries: 5
      start_period: 180s
    networks:
      - mall-network
  mall-selfcheck:
    image: registry.cn-hangzhou.aliyuncs.com/yinshi/guanghengzou-mall-selfcheck:1.0-SNAPSHOT
    container_name: mall-selfcheck
    restart: unless-stopped
    ports:
      - 8086:8086
    volumes:
      - /mydata/app/mall-selfcheck/logs:/var/logs
      - /etc/localtime:/etc/localtime
    environment:
      - TZ=Asia/Shanghai
      - JAVA_OPTS=-Xms128m -Xmx192m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Djava.security.egd=file:/dev/./urandom
      - spring.profiles.active=prod
    deploy:
      resources:
        limits:
          cpus: '0.2'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 128M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8086/actuator/health"]
      interval: 60s
      timeout: 15s
      retries: 5
      start_period: 120s
    networks:
      - mall-network
  mall-auth:
    image: registry.cn-hangzhou.aliyuncs.com/yinshi/guanghengzou-mall-auth:1.0-SNAPSHOT
    container_name: mall-auth
    restart: unless-stopped
    ports:
      - 8401:8401
    volumes:
      - /mydata/app/mall-auth/logs:/var/logs
      - /etc/localtime:/etc/localtime
    environment:
      - TZ=Asia/Shanghai
      - JAVA_OPTS=-Xms192m -Xmx320m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Djava.security.egd=file:/dev/./urandom
      - spring.profiles.active=prod
    deploy:
      resources:
        limits:
          cpus: '0.3'
          memory: 384M
        reservations:
          cpus: '0.15'
          memory: 192M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8401/actuator/health"]
      interval: 60s
      timeout: 15s
      retries: 5
      start_period: 120s
    networks:
      - mall-network
  mall-gateway:
    image: registry.cn-hangzhou.aliyuncs.com/yinshi/guanghengzou-mall-gateway:1.0-SNAPSHOT
    container_name: mall-gateway
    restart: unless-stopped
    ports:
      - 8201:8201
    volumes:
      - /mydata/app/mall-gateway/logs:/var/logs
      - /etc/localtime:/etc/localtime
    environment:
      - TZ=Asia/Shanghai
      - JAVA_OPTS=-Xms256m -Xmx384m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Djava.security.egd=file:/dev/./urandom
      - spring.profiles.active=prod
    deploy:
      resources:
        limits:
          cpus: '0.4'
          memory: 512M
        reservations:
          cpus: '0.2'
          memory: 256M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8201/actuator/health"]
      interval: 60s
      timeout: 15s
      retries: 5
      start_period: 120s
    networks:
      - mall-network
  mall-monitor:
    image: registry.cn-hangzhou.aliyuncs.com/yinshi/guanghengzou-mall-monitor:1.0-SNAPSHOT
    container_name: mall-monitor
    restart: unless-stopped
    ports:
      - 8101:8101
    volumes:
      - /mydata/app/mall-monitor/logs:/var/logs
      - /etc/localtime:/etc/localtime
    environment:
      - TZ=Asia/Shanghai
      - JAVA_OPTS=-Xms128m -Xmx192m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Djava.security.egd=file:/dev/./urandom
    deploy:
      resources:
        limits:
          cpus: '0.2'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 128M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8101/actuator/health"]
      interval: 60s
      timeout: 15s
      retries: 5
      start_period: 120s
    networks:
      - mall-network
