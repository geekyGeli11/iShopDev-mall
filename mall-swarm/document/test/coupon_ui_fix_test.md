# 优惠券界面修复测试指南

## 修复内容

本次修复解决了以下问题：
1. 选择排除分类和商品后页面没有更新显示的问题
2. 分类显示格式优化（支持一级分类和二级分类的正确显示）
3. 移除了已废弃的排除商品添加方法

## 测试场景

### 1. 分类选择和显示测试

#### 测试步骤：
1. 进入优惠券创建/编辑页面
2. 设置优惠券使用类型为"指定分类"
3. 测试可用分类选择：
   - 选择一级分类（如"服装"）
   - 点击"添加"按钮
   - 验证分类是否正确显示在表格中
   - 选择二级分类（如"服装 > 男装"）
   - 点击"添加"按钮
   - 验证分类是否正确显示在表格中

#### 预期结果：
- 一级分类显示：`服装`
- 二级分类显示：`服装 > 男装`
- 表格能正确显示添加的分类
- 不会出现空白或格式错误

### 2. 排除分类选择和显示测试

#### 测试步骤：
1. 启用"排除逻辑"开关
2. 测试排除分类选择：
   - 选择一级分类（如"数码"）
   - 点击"添加"按钮
   - 验证分类是否正确显示在排除分类表格中
   - 选择二级分类（如"数码 > 手机"）
   - 点击"添加"按钮
   - 验证分类是否正确显示在排除分类表格中

#### 预期结果：
- 一级分类显示：`数码`
- 二级分类显示：`数码 > 手机`
- 排除分类表格能正确显示添加的分类
- 不会出现空白或格式错误

### 3. 商品选择和显示测试

#### 测试步骤：
1. 设置优惠券使用类型为"指定商品"
2. 点击"选择商品"按钮
3. 在弹出的对话框中选择多个商品
4. 点击"确定"
5. 验证商品是否正确显示在可用商品表格中

#### 预期结果：
- 商品选择对话框正常弹出
- 可以正常选择商品
- 选择的商品正确显示在表格中
- 显示商品名称和货号

### 4. 排除商品选择和显示测试

#### 测试步骤：
1. 启用"排除逻辑"开关
2. 点击"选择排除商品"按钮
3. 在弹出的对话框中选择多个商品
4. 点击"确定"
5. 验证商品是否正确显示在排除商品表格中

#### 预期结果：
- 排除商品选择对话框正常弹出
- 可以正常选择商品
- 选择的商品正确显示在排除商品表格中
- 显示商品名称和货号

### 5. 冲突检查测试

#### 测试步骤：
1. 添加一个分类到可用分类列表
2. 尝试将同一个分类添加到排除分类列表
3. 验证是否显示冲突提示

#### 预期结果：
- 系统应该阻止添加并显示错误提示
- 提示信息：`该分类已在可用列表中，不能同时设为排除分类`

### 6. 父子分类冲突测试

#### 测试步骤：
1. 添加一级分类"服装"到可用分类列表
2. 尝试将二级分类"服装 > 男装"添加到排除分类列表
3. 验证是否显示冲突提示

#### 预期结果：
- 系统应该阻止添加并显示错误提示
- 提示信息：`该分类与可用列表中的父/子分类存在冲突`

### 7. 商品冲突检查测试

#### 测试步骤：
1. 选择一些商品添加到可用商品列表
2. 尝试将相同的商品添加到排除商品列表
3. 验证是否显示冲突提示

#### 预期结果：
- 系统应该阻止添加并显示错误提示
- 提示信息：`以下商品已在可用列表中，请先移除：商品A、商品B`

### 8. 删除功能测试

#### 测试步骤：
1. 添加一些分类和商品到各个列表中
2. 测试删除功能：
   - 删除可用分类
   - 删除排除分类
   - 删除可用商品
   - 删除排除商品

#### 预期结果：
- 所有删除操作都能正常工作
- 删除后表格正确更新
- 不会出现错误

### 9. 表单提交测试

#### 测试步骤：
1. 配置一个包含冲突的优惠券（如同一商品既在可用又在排除列表）
2. 尝试提交表单
3. 验证最终校验是否工作

#### 预期结果：
- 系统应该阻止提交并显示详细的冲突信息
- 提示用户解决冲突后再提交

## 常见问题排查

### 问题1：选择分类后表格没有显示
**可能原因**：
- 浏览器缓存问题
- JavaScript错误

**解决方法**：
- 清除浏览器缓存
- 检查浏览器控制台是否有错误信息

### 问题2：分类显示格式不正确
**可能原因**：
- 数据格式问题
- 模板渲染问题

**解决方法**：
- 检查分类数据是否正确加载
- 验证parentCategoryName字段是否正确

### 问题3：冲突检查不工作
**可能原因**：
- 冲突检查逻辑错误
- 数据比较问题

**解决方法**：
- 检查控制台错误信息
- 验证分类ID和商品ID是否正确

## 验收标准

✅ 所有分类选择后都能正确显示在表格中
✅ 所有商品选择后都能正确显示在表格中
✅ 一级分类显示格式正确（不显示父分类）
✅ 二级分类显示格式正确（显示"父分类 > 子分类"）
✅ 冲突检查功能正常工作
✅ 错误提示信息准确清晰
✅ 删除功能正常工作
✅ 表单提交时的最终校验正常工作

通过以上测试，确保优惠券管理界面的所有功能都能正常工作，用户体验良好。
