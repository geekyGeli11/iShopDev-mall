<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.macro.mall.dao.CmsTraceabilityProductRelationDao">

    <!-- 定义 resultMap 映射，继承基础映射并关联商品 -->
    <resultMap id="traceabilityProductMap" type="com.macro.mall.dto.CmsTraceabilityProduct" extends="com.macro.mall.mapper.CmsTraceabilityProductRelationMapper.BaseResultMap">
        <association property="product" resultMap="com.macro.mall.mapper.PmsProductMapper.BaseResultMap" columnPrefix="p_"/>
    </resultMap>

    <!-- 获取溯源和商品信息的查询 -->
    <select id="getList" resultMap="traceabilityProductMap">
        SELECT
        r.id,
        r.traceability_id,
        r.product_id,
        p.id p_id,
        p.name p_name,
        p.product_sn p_product_sn,
        p.price p_price,
        p.stock p_stock
        FROM
        cms_traceability_product_relation r
        LEFT JOIN pms_product p ON r.product_id = p.id
        <where>
            <if test="traceabilityId != null">
                AND r.traceability_id = #{traceabilityId}
            </if>
        </where>
    </select>

</mapper>
