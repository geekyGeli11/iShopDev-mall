# 调试功能测试指南

## 📱 调试功能概述

本项目已集成完整的调试功能，包括：
- **可拖拽的调试浮窗**：仅在开发环境显示
- **扫码过程调试**：详细记录会员码和商品条码扫描过程
- **API请求调试**：完整记录所有API请求和响应
- **错误信息收集**：自动捕获和记录错误信息

## 🔧 环境配置

### 1. 开发环境检查
确保项目运行在开发环境下：
```bash
# 检查环境变量
echo $NODE_ENV
# 或在浏览器控制台执行
console.log(import.meta.env.MODE)
```

### 2. 调试功能启用条件
调试浮窗仅在以下条件下显示：
- `import.meta.env.MODE === 'development'`
- `config.isDev === true`
- `config.debug.enableLog === true`

## 🚀 安卓设备测试步骤

### 步骤1：构建开发版本
```bash
# 进入项目目录
cd mall-self-checkout

# 安装依赖
npm install

# 构建开发版本
npm run build:dev

# 同步到安卓项目
npx cap sync android

# 在安卓设备上运行
npx cap run android
```

### 步骤2：验证调试浮窗显示
1. 启动应用后，在扫码页面查看是否显示调试浮窗
2. 调试浮窗应该显示在屏幕左上角，带有 🐛 图标
3. 点击浮窗可以展开/收起调试面板
4. 浮窗可以拖拽到屏幕任意位置

### 步骤3：测试扫码调试功能

#### 3.1 商品条码扫描测试
1. 进入扫码页面
2. 展开调试浮窗
3. 使用扫码器扫描商品条码（如：020306001）
4. 观察调试面板中的日志信息：
   - 扫码开始日志
   - 键盘输入过程日志
   - 扫码完成日志
   - API请求日志
   - 商品信息获取结果

#### 3.2 会员码扫描测试
1. 点击会员登录按钮
2. 选择"会员码登录"
3. 观察调试面板中的会员码扫描监听启动日志
4. 使用扫码器扫描会员二维码
5. 观察调试面板中的日志信息：
   - 会员码扫描监听启动
   - 键盘输入过程日志
   - 会员码识别完成日志
   - 会员登录API请求日志

### 步骤4：测试API调试功能
1. 执行任何触发API请求的操作（扫码、登录、支付等）
2. 在调试面板中查看API日志：
   - 请求开始时间
   - 请求方法和URL
   - 请求参数（敏感信息已隐藏）
   - 响应状态码
   - 响应数据
   - 请求耗时
   - 错误信息（如有）

## 🔍 调试面板功能说明

### 面板控制
- **🗑️ 清空日志**：清除所有调试日志
- **📤 导出日志**：将日志导出为JSON文件
- **📈/📉 展开/收起**：控制面板显示状态
- **❌ 关闭**：隐藏调试面板
- **📌/📍 自动滚动**：控制是否自动滚动到最新日志

### 日志过滤
- **类型过滤**：扫码、API、错误、信息、警告、成功
- **级别过滤**：调试、信息、警告、错误

### 日志图标说明
- 📱 扫码相关日志
- 🌐 API请求日志
- ❌ 错误日志
- ⚠️ 警告日志
- ✅ 成功日志
- ℹ️ 信息日志

## 🐛 常见问题排查

### 问题1：调试浮窗不显示
**可能原因：**
- 不在开发环境
- 调试功能未启用

**解决方案：**
```javascript
// 在浏览器控制台检查配置
console.log('环境:', import.meta.env.MODE)
console.log('调试配置:', window.__ENV_CONFIG__)
console.log('调试日志器:', window.__DEBUG_LOGGER__)
```

### 问题2：扫码日志不记录
**可能原因：**
- 扫码监听器未正确启动
- 调试日志器未初始化

**解决方案：**
```javascript
// 检查扫码管理器状态
console.log('当前激活的扫码类型:', scanManager.getCurrentActiveType())
console.log('商品扫码是否激活:', scanManager.isActive('product'))
console.log('会员码扫码是否激活:', scanManager.isActive('member'))
```

### 问题3：API日志不记录
**可能原因：**
- API拦截器未正确配置
- 请求未通过axios实例

**解决方案：**
```javascript
// 检查API拦截器状态
console.log('API调试拦截器:', window.__API_DEBUG_INTERCEPTOR__)
console.log('待处理请求数量:', window.__API_DEBUG_INTERCEPTOR__.getPendingRequestsCount())
```

## 📊 性能监控

### 扫码性能指标
- 扫码识别耗时
- API请求响应时间
- 商品信息加载时间

### 内存使用监控
- 日志条目数量限制：500条
- 自动清理超时请求：30秒
- 定期清理机制：每分钟

## 🔒 安全注意事项

### 敏感信息保护
调试功能已自动隐藏以下敏感信息：
- 密码字段
- Token和授权信息
- 会员码详细信息
- 验证码
- 支付相关敏感数据

### 生产环境安全
- 调试功能仅在开发环境启用
- 生产环境自动禁用所有调试功能
- 不会影响生产环境性能

## 📝 测试检查清单

### 基础功能测试
- [ ] 调试浮窗正常显示
- [ ] 浮窗可以拖拽移动
- [ ] 浮窗可以展开/收起
- [ ] 日志过滤功能正常
- [ ] 日志导出功能正常

### 扫码功能测试
- [ ] 商品条码扫描日志记录完整
- [ ] 会员码扫描日志记录完整
- [ ] 扫码错误信息正确记录
- [ ] 扫码性能指标准确

### API功能测试
- [ ] 所有API请求都有日志记录
- [ ] 请求参数记录完整（敏感信息已隐藏）
- [ ] 响应数据记录完整
- [ ] 错误信息记录详细
- [ ] 请求耗时统计准确

### 错误处理测试
- [ ] 网络错误正确记录
- [ ] 业务错误正确记录
- [ ] 全局错误正确捕获
- [ ] 错误堆栈信息完整

## 🎯 测试完成标准

当以下所有项目都通过测试时，调试功能集成完成：

1. ✅ 调试浮窗在开发环境正常显示
2. ✅ 商品扫码过程完整记录
3. ✅ 会员码扫码过程完整记录
4. ✅ API请求响应完整记录
5. ✅ 错误信息准确捕获
6. ✅ 性能指标正确统计
7. ✅ 敏感信息正确隐藏
8. ✅ 生产环境功能正确禁用

## 📞 技术支持

如果在测试过程中遇到问题，请：
1. 检查浏览器控制台错误信息
2. 导出调试日志进行分析
3. 记录具体的复现步骤
4. 提供设备和环境信息

---

**注意：此调试功能仅用于开发和测试阶段，不会在生产环境中启用。**
